{%- assign normal_posts_count = 0 -%}
{%- assign archived_posts_count = 0 -%}
{%- for post in posts -%}
  {%- if post.draft and jekyll.environment == 'production' -%}
    {%- continue -%}
  {%- endif -%}
  {%- if post.archived -%}
    {%- assign archived_posts_count = archived_posts_count | plus: 1 -%}
  {%- else -%}
    {%- assign normal_posts_count = normal_posts_count | plus: 1 -%}
  {%- endif -%}
{%- endfor -%}

{%- if normal_posts_count > 0 -%}
  {%- assign is_first_normal_post = true -%}
  {%- for post in posts -%}
    {%- if post.draft and jekyll.environment == 'production' -%}
      {%- continue -%}
    {%- endif -%}
    {%- if post.archived -%}
      {%- continue -%}
    {%- endif -%}
    {%- assign normal_posts_count = normal_posts_count | minus: 1 -%}

    {%- if is_first_normal_post and include.layout == 'home' -%}
      {% comment %} First normal post - special handling BEGIN {% endcomment %}
      <a
        class='
          no-select no-print pagination__item-wrapper pagination__item-wrapper--first
          {% if post.draft and jekyll.environment != 'production' %}
            pagination__item-wrapper--draft
          {% endif %}
        '
        href='{{ post.url | relative_url }}'
      >
        <span class='pagination__item-title'>
          {% if post.series %}
            <div class='pagination__item-title-series'>
              {{ post.series }} | ({{ post.series_index }})
            </div>
          {% endif %}
          <div class='pagination__item-title-text'>
            {{ post.title }}
            {%- if post.draft and jekyll.environment != 'production' -%}
              <span class='pagination__item-title-text--edit-icon material-symbols-outlined'>
                stylus_note
              </span>
            {%- endif -%}
          </div>
        </span>
        {%- if post.draft and jekyll.environment != 'production' -%}
          <div class='pagination__item-draft'>
            Draft will hide on production
          </div>
        {%- endif -%}
        <div class='pagination__item-info'>
          <div class='pagination__item-time'>
            <span class='pagination__item-info-icon material-symbols-outlined'> calendar_month </span>
            {{- post.date | date: site.theme_config.date_format -}}
          </div>
          <div class='pagination__item-category'>
            <span class='pagination__item-info-icon material-symbols-outlined'> archive </span>
            {{- post.categories -}}
          </div>
          <div class='pagination__item-tag'>
            {% for tag in post.tags %}
              <div class='pagination__item-tag-item'>
                <span class='pagination__item-info-icon material-symbols-outlined'> tag </span>{{ tag }}
              </div>
            {% endfor %}
          </div>
        </div>
        <div class='pagination__item-summary'>
          {{ post.summary | strip_html }}
        </div>
      </a>
      {% comment %} First normal post - special handling END {% endcomment %}
      {%- assign is_first_normal_post = false -%}
    {%- else -%}
      {%- if is_first_normal_post -%}
        {%- assign is_first_normal_post = false -%}
      {%- endif -%}
      {% comment %} Regular normal post - standard handling BEGIN {% endcomment %}
      <a
        class='
          no-select no-print pagination__item-wrapper
          {% if post.draft and jekyll.environment != 'production' %}
            pagination__item-wrapper--draft
          {% endif %}
        '
        href='{{ post.url | relative_url }}'
      >
        <span class='pagination__item-title'>
          {% if post.series %}
            <div class='pagination__item-title-series'>
              {{ post.series }} | ({{ post.series_index }})
            </div>
          {% endif %}
          <div class='pagination__item-title-text'>
            {{ post.title }}
            {%- if post.draft and jekyll.environment != 'production' -%}
              <span class='pagination__item-title-text--edit-icon material-symbols-outlined'>
                stylus_note
              </span>
            {%- endif -%}
          </div>
        </span>
        {%- if post.draft and jekyll.environment != 'production' -%}
          <div class='pagination__item-draft'>
            Draft will hide on production
          </div>
        {%- endif -%}
        <div class='pagination__item-info'>
          <div class='pagination__item-time'>
            <span class='pagination__item-info-icon material-symbols-outlined'> calendar_month </span>
            {{- post.date | date: site.theme_config.date_format -}}
          </div>
          <div class='pagination__item-category'>
            <span class='pagination__item-info-icon material-symbols-outlined'> archive </span>
            {{- post.categories -}}
          </div>
          <div class='pagination__item-tag'>
            {% for tag in post.tags %}
              <div class='pagination__item-tag-item'>
                <span class='pagination__item-info-icon material-symbols-outlined'> tag </span>{{ tag }}
              </div>
            {% endfor %}
          </div>
        </div>
      </a>
      {% comment %} Regular normal post - standard handling END {% endcomment %}
      {%- unless normal_posts_count == 0 -%}
        <hr class='no-select no-print pagination__separator'>
      {%- endunless -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- if archived_posts_count > 0 -%}
  <details class='pagination__item-wrapper--archived'>
    <summary class='pagination__item-wrapper-title--archived'>
      Archived Posts
    </summary>
    <div class='pagination__item-wrapper-content--archived'>
      {%- for post in posts -%}
        {%- if post.draft and jekyll.environment == 'production' -%}
          {%- continue -%}
        {%- endif -%}
        {%- if post.archived -%}
          {%- assign archived_posts_count = archived_posts_count | minus: 1 -%}
          <a
            class='
              no-select no-print pagination__item-wrapper
              {% if post.draft and jekyll.environment != 'production' %}
                pagination__item-wrapper--draft
              {% endif %}
            '
            href='{{ post.url | relative_url }}'
          >
            <span class='pagination__item-title'>
              {% if post.series %}
                <div class='pagination__item-title-series'>
                  {{ post.series }} | ({{ post.series_index }})
                </div>
              {% endif %}
              <div class='pagination__item-title-text'>
                {{ post.title }}
                {%- if post.draft and jekyll.environment != 'production' -%}
                  <span class='pagination__item-title-text--edit-icon material-symbols-outlined'>
                    stylus_note
                  </span>
                {%- endif -%}
              </div>
            </span>
            {%- if post.draft and jekyll.environment != 'production' -%}
              <div class='pagination__item-draft'>
                Draft will hide on production
              </div>
            {%- endif -%}
            <div class='pagination__item-info'>
              <div class='pagination__item-time'>
                <span class='material-symbols-outlined'> calendar_month </span>
                {{- post.date | date: site.theme_config.date_format -}}
              </div>
              <div class='pagination__item-category'>
                <span class='material-symbols-outlined'> archive </span>
                {{- post.categories -}}
              </div>
              <div class='pagination__item-tag'>
                {% for tag in post.tags %}
                  <span class='material-symbols-outlined'> tag </span>{{ tag }}
                {% endfor %}
              </div>
            </div>
          </a>
          {%- unless archived_posts_count == 0 -%}
            <hr class='no-select no-print pagination__separator'>
          {%- endunless -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  </details>
{%- endif -%}

{%- assign non_draft_posts_count = 0 -%}
{%- for post in posts -%}
  {%- unless post.draft and jekyll.environment == 'production' -%}
    {%- assign non_draft_posts_count = non_draft_posts_count | plus: 1 -%}
  {%- endunless -%}
{%- endfor -%}

{%- if jekyll.environment == 'production' -%}
  <p class='no-select no-print pagination__count'>
    {%- if non_draft_posts_count == 0 -%}
      - no public post -
    {%- elsif non_draft_posts_count == 1 -%}
      - find 1 public post -
    {%- else -%}
      - find {{ non_draft_posts_count }} public posts -
    {%- endif -%}
  </p>
{%- else -%}
  <p class='no-select no-print pagination__count'>
    {%- if non_draft_posts_count == 0 -%}
      - no post -
    {%- elsif non_draft_posts_count == 1 -%}
      - find 1 post -
    {%- else -%}
      - find {{ non_draft_posts_count }} posts -
    {%- endif -%}
  </p>
{%- endif -%}
