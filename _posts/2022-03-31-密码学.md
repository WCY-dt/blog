---
layout: post
title:  "有趣的密码学"
date:   2022-03-31 00:00:00 +0800
categories: notes
tags: 密码学 安全
comments: 1
mathjax: true
copyrights: 原创
---

一篇密码学科普。

# 1 什么是密码学？

<img src="https://s2.loli.net/2022/04/04/XmPBjxNgzJCkWMH.png" alt="image-20220331104721799" style="zoom: 33%;" />

说到密码学，我们的第一印象很可能是“如何设置一个更安全的密码”。我们也许还会想起“摩斯密码 (Morse code)”。这些都是密码学要研究的内容，但它们并不是密码学的全部。在讨论“密码学研究什么”之前，我们不妨先看一个小故事。

## 1.1 凯撒的烦恼

很久很久以前，有个叫凯撒 (Caesar) 的家伙，带领罗马到处打仗、扩张领土。很快，罗马就成了横跨亚非欧的超级大国。与此同时，凯撒有点烦恼：如果自己在欧罗巴，想要向亚细亚发一条指令，就必须要通过信件的方式传输。然而，距离越长，被截胡的可能性越大。敌人只要拿到了信件，就掌握了罗马的最新情报。

必须想办法，让敌人拿到信件也看不懂！

凯撒和谋士一合计，整了这么个方法：

<img src="https://s2.loli.net/2022/04/04/vjIuf6cLpRTP12S.png" alt="image-20220331112141207" style="zoom:50%;" />

凯撒将字母表“转了转”[^1]，把后面几个字母“转”到前面来，再形成一一对应。例如上图，就是“转”了 `VWXYZ` 5 个字母。现在，字母 `A` 对应 `V`，字母 `B` 对应 `W`……如果凯撒想要发送 `YOU ARE A PIG`，他就应当根据对应关系，写成 `TJP VMZ V KDB`。

这下子，敌人拿到信件就一头雾水了；而自己人，只需要根据对应关系“转回去”就能看到原来的内容。

> 凯撒原来想发的内容就叫做<mark>明文</mark>，实际发送的内容叫做<mark>密文</mark>。由明文转换为密文的过程被称为<mark>加密</mark>，而由密文转换为明文的过程被称为<mark>解密</mark>。
>
> 凯撒的这种加密方式被后人称为<mark>凯撒密码</mark>。凯撒密码是最简单、最经典的密码之一。凯撒密码能够保密的关键是攻击者不知道“旋转”的字母个数，例如上面的例子就“转”了 5 个字母。这个数量被称为<mark>偏移量</mark>。

## 1.2 被误传的维吉尼亚

凯撒密码确实好用，可是有一个问题：它的保密性依赖于敌人不知道它的偏移量。然而，对于 26 个字母的字母表来说，敌人只需要尝试 25 次就一定能解密出明文。有没有办法让敌人的解密变得更快呢？

16 世纪，贝拉索 (Giovan Battista Bellaso) 老先生想到了一个办法[^2]：凯撒给整个消息设置了一个偏移量，我可不可以给每个字母设置一个偏移量呢？

比如，我们规定第 1 个字母偏移量为 1，第 2 个字母偏移量为 0，第 3 个字母偏移量为 8，第 4 个字母偏移量为 3，第 5 个字母偏移量为 20。那么，如果我们要发送 `CRYPTO`，根据
$$
C\stackrel{1}{\longrightarrow}D\\
R\stackrel{0}{\longrightarrow}R\\
Y\stackrel{8}{\longrightarrow}G\\
P\stackrel{3}{\longrightarrow}S\\
T\stackrel{20}{\longrightarrow}N
$$
则可以加密为 `DRGSN`……等一下，我们只规定了五位的偏移量，那第六位怎么办呢？贝拉索老先生说[^3]：厉行节俭，循环着用！于是，第 6 位偏移量与第 1 位相同为 1，第 7 位偏移量与第 2 位相同为 0……于是，再根据
$$
O\stackrel{1}{\longrightarrow}P
$$
我们得到 `CRYPTO` 的密文为 `DRGSNP`。

记住好多个数字挺难的——至少对于我来说。所以，我们规定从 A 到 Z 分别代表 0 到 26，然后用一串字母就可以表示偏移量序列。例如上面例子的序列为 `BAIDU`。但这依然挺麻烦的，毕竟要一个字母一个字母的计算。贝拉索老先生于是又说[^4]：好吧，那我直接把对应关系给你！

<img src="https://s2.loli.net/2022/04/04/MR8Te6WNcv2ZUdq.png" alt="image-20220331153605853" style="zoom:50%;" />

每一列代表需要加密的字母，每一行代表偏移量的字母，找到交叉点，就是密文的字母了。

> 像 `baidu` 这样用来加密明文的字符串、数字等等，被称为<mark>密钥</mark>。
>
> 贝拉索老先生搞出来的这个加密方法被称为<mark>维吉尼亚密码</mark>。

咦？贝拉索老先生搞出来的，怎么会叫维吉尼亚呢？因为在19世纪时，这种加密方式被误传为是法国外交官维吉尼亚 (Blaise De Vigenère) 所创造，于是贝拉索老先生的功劳就被埋没了。

## 1.3 来点数学

我们可以说，凯撒密码是维吉尼亚密码的一个特例：当维吉尼亚密码每个位置的偏移量都相同时，就变成了凯撒密码。这两种密码都是一个字母一个字母加密的，攻击者如果想要破解，总可以一个字母一个字母破解出来。

1929 年，希尔老先生 (Lester S. Hill) 说[^5]：你不是一个字母一个字母地破解吗？那我把好多字母混在一起加密，看你怎么办！

具体怎么加密解密呢？比如我们有一个 6 位的数字串 `[2,4,3,1,7,0]` 需要加密，我们可以将其分为 2 组，每组 3 个数字进行加密。我们的密钥是一个矩阵
$$
\left[\begin{matrix}
1&2&3\\
4&5&6\\
9&8&7
\end{matrix}\right]
$$
加密时，我们只需要用这个矩阵乘以需要加密的一组数字，即
$$
\left[\begin{matrix}
1&2&3\\
4&5&6\\
9&8&7
\end{matrix}\right]
\left[\begin{matrix}
2\\
4\\
3
\end{matrix}\right]=
\left[\begin{matrix}
19\\
46\\
71
\end{matrix}\right]\\
\left[\begin{matrix}
1&2&3\\
4&5&6\\
9&8&7
\end{matrix}\right]
\left[\begin{matrix}
1\\
7\\
0
\end{matrix}\right]=
\left[\begin{matrix}
15\\
39\\
65
\end{matrix}\right]
$$
于是得到密文为 `[19,46,71,15,39,65]`。

这里面涉及到了一些线性代数的知识，我知道数学是令人头大的。但是，密码学离不开数学，或者说，密码学就是数学。

回到正题上来。上面是一个加密的特例，一般的，对于 $n$ 位一组的加密方式来说，加密过程为
$$
\left[\begin{matrix}
c_1\\
\vdots\\
c_n
\end{matrix}\right]=
\left[\begin{matrix}
k_{11}&\cdots&k_{1n}\\
\vdots&&\vdots\\
k_{n1}&\cdots&k_{nn}
\end{matrix}\right]
\left[\begin{matrix}
p_1\\
\vdots\\
p_n
\end{matrix}\right]
$$
简记为
$$
C=KP
$$
其中，$C$ 为密文，$K$ 为密钥，$P$ 为明文。

根据矩阵的相关知识，我们得知，解密的过程为
$$
P=K^{-1}C
$$
而这次对于攻击者来说，破解出你的密钥就有点费力了。他需要在同时知道明文和密文的情况下，根据
$$
K=CP^{-1}
$$
解得密钥。

> 希尔提出的加密方式被称为<mark>希尔密码</mark>。

## 1.4 还有一点问题……

我们上面简单了解了三种加密方式：凯撒密码、维吉尼亚密码、希尔密码。

> 凯撒密码只有一个偏移量，被称为<mark>单表代换密码</mark>；维吉尼亚密码对每个字母分别做变换，被称为<mark>多表代换密码</mark>；希尔密码对一组字母同时进行变换，被称为<mark>多字母代换密码</mark>。此外还有一种<mark>置换密码</mark>，这种密码不改变字母，但打乱了字母顺序。
>
> 以上密码类型看似坚固，实际上有很多缺陷。它们被统称为<mark>古典密码</mark>，是很多密码算法的基础；与之相对的，则是<mark>近代密码</mark>和<mark>现代密码</mark>。
>
> 以上密码的关系如下所示：
> $$
> \left\{\begin{array}{l}\text{古典密码}\left\{\begin{array}{l}\text{代换密码}\left\{\begin{array}{l}\text{单字母代换密码}\left\{\begin{array}{l}\text{单表代换密码}\\\text{多表代换密码}\end{array}\right.\\\text{多字母代换密码}\end{array}\right.\\text{置换密码}\end{array}\right.\\\text{近代密码}\\\text{现代密码}\end{array}\right.
> $$

问题来了，古典密码已经使用了看起来很复杂的加密手段，为什么说它们“有很多缺陷”呢？我们思考以下几个问题：

- **机密性**：如何让别人即使拿到凯撒的信件也无法破解？
- **数据完整性**：凯撒传信件时，如何确保中途没有人掉包？
- **鉴别**：接收凯撒信件的人，如何确认信件确实是凯撒发的？
- **访问控制**：如何只让希望看到信件的人看到，而别的人看不到信件？
- **抗抵赖**：凯撒发了错误的命令，时候又不承认怎么办？

<img src="https://s2.loli.net/2022/04/04/ONcmaeMKTHo27qs.png" alt="image-20220331174741023" style="zoom:50%;" />

这些，都是密码学近百年来着重研究、并部分解决了的问题。在后面的章节中，我们将会看看近现代密码学是如何解决这些问题的。

[^1]: 实际上，凯撒时期使用的是罗马字母。我们这里为了简便起见，使用了英文字母。
[^2]: *La cifra del. Sig. Giovan Battista Bellaso*，1553 年出版。
[^3]: 他没有这么说过，这是我说的。
[^4]:他没有这么说过，这也是我说的。
[^5]:他没有这么说过，这还是我说的。
