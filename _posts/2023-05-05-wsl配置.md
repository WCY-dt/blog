---
layout: post
title:  "【杂项】WSL 配置"
date:   2023-05-05 00:00:00 +0800
categories: 其它
tags: Linux
comments: 1
mathjax: true
copyrights: 原创
---

今天把 WSL 搞崩了，只好重装。这里记录一下其中一些步骤。

我的环境是 Windows11 + WSL2(Ubuntu22.04LTS)。如果用了不同的系统，可能会有细微的差异。

不知道谁说过，国内程序员学得最好的一定是计算机网络。我在重装的时候遇到了一些网络上的问题，这里记录一下解决方法。

# 换源

我这里直接换的清华源。在 [清华大学开源软件镜像站 | Ubuntu 软件仓库镜像](https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/) 直接复制镜像：

```list
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse

# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
# # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse

deb http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse
# deb-src http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
# # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
```

然后

```shell
vim /etc/apt/sources.list
```

删掉原来的所有内容，把上面这段粘贴进去。接着更新一下即可：

```shell
sudo apt update && sudo apt upgrade
```

# 代理

我的代理工具是 clash，默认端口 7890。先打开 clash 的 `Allow LAN`。

然后 `sudo vim ~/.bashrc`，添加

```shell
host_ip=$(cat /etc/resolv.conf |grep "nameserver" |cut -f 2 -d " ")
export http_proxy="http://$host_ip:7890"
export https_proxy="http://$host_ip:7890"
```

如果你改过默认端口，把这里的 `7890` 换成你自己的端口即可。

然后我们需要把环境变量持久化一下，运行 `sudo visudo`，然后添加

```
Defaults env_keep="http_proxy https_proxy"
```

输入 `source ~/.bashrc` 更新一下配置，然后就可以 curl 到 google 了。

# git

git 的代理需要单独设置，直接运行

```shell
git config --global http.proxy http://$host_ip:7890
git config --global https.proxy https://$host_ip:7890
```
