<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome AI æ‘˜è¦ API æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 16px;
            padding: 32px;
            border: 2px solid #f0f0f0;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 32px;
            font-size: 28px;
            font-weight: 600;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option-group label {
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        select {
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }

        select:focus {
            outline: none;
            border-color: #d74514;
        }

        .sample-articles {
            margin-bottom: 24px;
        }

        .sample-articles h3 {
            color: #333;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .sample-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .sample-btn {
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 14px;
        }

        .sample-btn:hover {
            border-color: #d74514;
            background: #fef7f5;
        }

        .sample-title {
            font-weight: 600;
            color: #333;
            display: block;
            margin-bottom: 4px;
        }

        .sample-desc {
            color: #666;
            font-size: 12px;
            line-height: 1.3;
        }

        .input-area, .context-area {
            margin-bottom: 24px;
        }

        .input-area label, .context-area label {
            display: block;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
        }

        textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            min-height: 200px;
            transition: border-color 0.3s ease;
            font-family: inherit;
            line-height: 1.5;
        }

        textarea:focus {
            outline: none;
            border-color: #d74514;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #d74514;
        }

        .action-area {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            justify-content: center;
        }

        .summarize-btn, .stream-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .summarize-btn {
            background: #d74514;
            color: white;
        }

        .summarize-btn:hover:not(:disabled) {
            background: #b73a12;
            transform: translateY(-2px);
        }

        .stream-btn {
            background: #28a745;
            color: white;
        }

        .stream-btn:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
        }

        .summarize-btn:disabled, .stream-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 16px;
            display: none;
            border: 1px solid #ddd;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d74514, #ff6b35);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .progress-info {
            display: none;
            text-align: center;
            margin-bottom: 12px;
            font-size: 14px;
            color: #555;
        }

        .progress-info.active {
            display: block;
        }

        .progress-percentage {
            font-weight: bold;
            color: #d74514;
        }

        .progress-status {
            margin-top: 4px;
            font-size: 12px;
            color: #666;
        }

        .status {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
            min-height: 20px;
        }

        .error {
            background: #fee;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #c53030;
            margin-bottom: 16px;
            display: none;
        }

        .info-tip {
            background: #e8f4fd;
            color: #1a365d;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #3182ce;
            margin-bottom: 16px;
        }

        .info-tip .tip-content strong {
            display: block;
            margin-bottom: 8px;
            color: #2c5282;
        }

        .info-tip ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .info-tip li {
            margin: 4px 0;
        }

        .output-area {
            margin-bottom: 24px;
        }

        .output-area label {
            display: block;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
        }

        .output-box {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            min-height: 120px;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            overflow-wrap: break-word;
        }

        .output-box.streaming {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { border-color: #e0e0e0; }
            50% { border-color: #28a745; }
        }

        .cancel-btn {
            background: #dc3545;
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            display: none;
        }

        .cancel-btn:hover:not(:disabled) {
            background: #c82333;
            transform: translateY(-2px);
        }

        .cancel-btn.active {
            display: inline-block;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
                margin: 8px;
                border-radius: 12px;
            }

            h1 {
                font-size: 22px;
                margin-bottom: 24px;
            }

            .options-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 16px;
                margin-bottom: 20px;
            }

            .option-group label {
                font-size: 13px;
            }

            select {
                padding: 8px 10px;
                font-size: 14px;
            }

            .sample-articles {
                margin-bottom: 20px;
            }

            .sample-articles h3 {
                font-size: 15px;
                margin-bottom: 10px;
            }

            .sample-buttons {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .sample-btn {
                padding: 12px 14px;
                font-size: 13px;
            }

            .sample-title {
                font-size: 14px;
                margin-bottom: 3px;
            }

            .sample-desc {
                font-size: 11px;
            }

            .input-area, .context-area, .output-area {
                margin-bottom: 20px;
            }

            .input-area label, .context-area label, .output-area label {
                font-size: 14px;
                margin-bottom: 6px;
            }

            textarea {
                padding: 12px;
                font-size: 15px;
                min-height: 160px;
            }

            input[type="text"] {
                padding: 10px 12px;
                font-size: 15px;
            }

            .action-area {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                margin-bottom: 20px;
            }

            .summarize-btn, .stream-btn, .cancel-btn {
                min-width: auto;
                padding: 12px 24px;
                font-size: 15px;
            }

            .output-box {
                padding: 12px;
                min-height: 100px;
                font-size: 15px;
            }

            .progress-info {
                font-size: 13px;
            }

            .progress-bar {
                height: 6px;
                margin-bottom: 12px;
            }

            .status {
                font-size: 13px;
                margin-bottom: 12px;
            }

            .error {
                padding: 10px;
                font-size: 13px;
                margin-bottom: 12px;
            }

            .info-tip {
                padding: 12px;
                font-size: 13px;
                margin-bottom: 12px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
            }

            .container {
                padding: 16px;
                margin: 5px;
                border-radius: 8px;
            }

            h1 {
                font-size: 20px;
                margin-bottom: 20px;
            }

            .options-grid {
                padding: 12px;
                gap: 10px;
                margin-bottom: 16px;
            }

            .option-group label {
                font-size: 12px;
            }

            select {
                padding: 6px 8px;
                font-size: 13px;
            }

            .sample-articles h3 {
                font-size: 14px;
                margin-bottom: 8px;
            }

            .sample-btn {
                padding: 10px 12px;
                font-size: 12px;
            }

            .sample-title {
                font-size: 13px;
            }

            .sample-desc {
                font-size: 10px;
            }

            textarea {
                padding: 10px;
                font-size: 14px;
                min-height: 120px;
            }

            input[type="text"] {
                padding: 8px 10px;
                font-size: 14px;
            }

            .action-area {
                gap: 8px;
                margin-bottom: 16px;
            }

            .summarize-btn, .stream-btn, .cancel-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .output-box {
                padding: 10px;
                min-height: 80px;
                font-size: 14px;
            }

            .input-area, .context-area, .output-area {
                margin-bottom: 16px;
            }

            .input-area label, .context-area label, .output-area label {
                font-size: 13px;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chrome AI æ‘˜è¦ API æ¼”ç¤º</h1>

        <div class="options-grid">
            <div class="option-group">
                <label for="summaryType">æ‘˜è¦ç±»å‹</label>
                <select id="summaryType">
                    <option value="key-points">å…³é”®ç‚¹ (key-points)</option>
                    <option value="tldr">ç®€è¦æ€»ç»“ (tl;dr)</option>
                    <option value="teaser">é¢„å‘Šç‰‡ (teaser)</option>
                    <option value="headline">æ ‡é¢˜ (headline)</option>
                </select>
            </div>

            <div class="option-group">
                <label for="summaryLength">æ‘˜è¦é•¿åº¦</label>
                <select id="summaryLength">
                    <option value="short">çŸ­ (short)</option>
                    <option value="medium" selected>ä¸­ (medium)</option>
                    <option value="long">é•¿ (long)</option>
                </select>
            </div>

            <div class="option-group">
                <label for="summaryFormat">è¾“å‡ºæ ¼å¼</label>
                <select id="summaryFormat">
                    <option value="markdown" selected>Markdown</option>
                    <option value="plain-text">çº¯æ–‡æœ¬</option>
                </select>
            </div>

            <div class="option-group">
                <label for="outputLanguage">è¾“å‡ºè¯­è¨€</label>
                <select id="outputLanguage">
                    <option value="zh">ä¸­æ–‡ (zh)</option>
                    <option value="en" selected>è‹±è¯­ (en)</option>
                    <option value="es">è¥¿ç­ç‰™è¯­ (es)</option>
                    <option value="ja">æ—¥è¯­ (ja)</option>
                </select>
            </div>
        </div>

        <div class="sample-articles">
            <h3>ç¤ºä¾‹æ–‡ç« </h3>
            <div class="sample-buttons">
                <button class="sample-btn" data-title="æŠ€æœ¯æ–‡ç« " data-context="This is a technical article about web development">
                    <span class="sample-title">Webå¼€å‘æŠ€æœ¯</span>
                    <span class="sample-desc">ç°ä»£å‰ç«¯æ¡†æ¶å’Œå·¥å…·çš„æ·±å…¥ä»‹ç»</span>
                </button>
                <button class="sample-btn" data-title="ç§‘å­¦ç ”ç©¶" data-context="This is a scientific research paper">
                    <span class="sample-title">äººå·¥æ™ºèƒ½ç ”ç©¶</span>
                    <span class="sample-desc">æœºå™¨å­¦ä¹ åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„åº”ç”¨</span>
                </button>
                <button class="sample-btn" data-title="æ–°é—»æ–‡ç« " data-context="This is a news article">
                    <span class="sample-title">ç§‘æŠ€æ–°é—»</span>
                    <span class="sample-desc">æœ€æ–°çš„ç§‘æŠ€è¡Œä¸šå‘å±•åŠ¨æ€</span>
                </button>
                <button class="sample-btn" data-title="ç”¨æˆ·æ‰‹å†Œ" data-context="This is a user manual or documentation">
                    <span class="sample-title">äº§å“æ–‡æ¡£</span>
                    <span class="sample-desc">è½¯ä»¶äº§å“çš„ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µ</span>
                </button>
            </div>
        </div>

        <div class="input-area">
            <label for="inputText">è¯·è¾“å…¥è¦æ‘˜è¦çš„æ–‡æœ¬ï¼š</label>
            <textarea id="inputText" placeholder="ç²˜è´´æˆ–è¾“å…¥éœ€è¦æ‘˜è¦çš„é•¿æ–‡æœ¬..."></textarea>
        </div>

        <div class="context-area">
            <label for="contextText">ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ï¼š</label>
            <input type="text" id="contextText" placeholder="ä¾‹å¦‚ï¼šThis article is intended for tech-savvy audience">
        </div>

        <div class="action-area">
            <button id="summarizeBtn" class="summarize-btn">ç”Ÿæˆæ‘˜è¦</button>
            <button id="streamBtn" class="stream-btn">æµå¼ç”Ÿæˆ</button>
            <button id="cancelBtn" class="cancel-btn">å–æ¶ˆæ“ä½œ</button>
        </div>

        <div class="progress-info" id="progressInfo">
            <div class="progress-percentage" id="progressPercentage">0%</div>
            <div class="progress-status" id="progressStatus">å‡†å¤‡ä¸‹è½½...</div>
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="status" id="status"></div>

        <div class="error" id="errorMessage"></div>

        <div class="info-tip" id="downloadTip" style="display: none;">
            <div class="tip-content">
                <strong>ğŸ’¡ é¦–æ¬¡ä½¿ç”¨æç¤ºï¼š</strong>
                <p>Chrome AI æ‘˜è¦åŠŸèƒ½é¦–æ¬¡ä½¿ç”¨æ—¶éœ€è¦ä¸‹è½½çº¦30-100MBçš„æ¨¡å‹æ–‡ä»¶ã€‚ä¸‹è½½æ—¶é—´å–å†³äºæ‚¨çš„ç½‘ç»œé€Ÿåº¦ï¼š</p>
                <ul>
                    <li>å¿«é€Ÿç½‘ç»œï¼š1-3åˆ†é’Ÿ</li>
                    <li>ä¸€èˆ¬ç½‘ç»œï¼š3-10åˆ†é’Ÿ</li>
                    <li>æ…¢é€Ÿç½‘ç»œï¼šå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´</li>
                </ul>
                <p>è¯·è€å¿ƒç­‰å¾…ï¼Œä¸‹è½½å®Œæˆååç»­ä½¿ç”¨å°†ä¼šå¾ˆå¿«ã€‚</p>
            </div>
        </div>



        <div class="output-area">
            <label>æ‘˜è¦ç»“æœï¼š</label>
            <div class="output-box" id="outputText">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ç”Ÿæˆæ‘˜è¦...</div>
        </div>
    </div>

    <script>
        class SummarizerDemo {
            constructor() {
                this.summarizer = null;
                this.isStreaming = false;
                this.currentOperation = null;
                this.operationTimeout = null;
                this.initializeElements();
                this.bindEvents();
                this.loadSampleContent();
                this.checkAPISupport();
            }

            initializeElements() {
                this.summaryType = document.getElementById('summaryType');
                this.summaryLength = document.getElementById('summaryLength');
                this.summaryFormat = document.getElementById('summaryFormat');
                this.outputLanguage = document.getElementById('outputLanguage');
                this.inputText = document.getElementById('inputText');
                this.contextText = document.getElementById('contextText');
                this.summarizeBtn = document.getElementById('summarizeBtn');
                this.streamBtn = document.getElementById('streamBtn');
                this.cancelBtn = document.getElementById('cancelBtn');
                this.outputText = document.getElementById('outputText');
                this.status = document.getElementById('status');
                this.errorMessage = document.getElementById('errorMessage');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.progressInfo = document.getElementById('progressInfo');
                this.progressPercentage = document.getElementById('progressPercentage');
                this.progressStatus = document.getElementById('progressStatus');
                this.downloadTip = document.getElementById('downloadTip');
            }

            bindEvents() {
                this.summarizeBtn.addEventListener('click', () => this.summarize());
                this.streamBtn.addEventListener('click', () => this.summarizeStreaming());
                this.cancelBtn.addEventListener('click', () => this.cancelOperation());

                // ç¤ºä¾‹æ–‡ç« æŒ‰é’®
                document.querySelectorAll('.sample-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const title = btn.getAttribute('data-title');
                        const context = btn.getAttribute('data-context');
                        this.loadSampleArticle(title, context);
                    });
                });

                // é€‰é¡¹æ”¹å˜æ—¶é‡æ–°åˆ›å»ºæ‘˜è¦å™¨
                [this.summaryType, this.summaryLength, this.summaryFormat, this.outputLanguage].forEach(select => {
                    select.addEventListener('change', () => {
                        this.resetSummarizer();
                    });
                });
            }



            async checkAPISupport() {
                if (!('Summarizer' in self)) {
                    this.showError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ Chrome AI æ‘˜è¦ APIã€‚è¯·ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chrome æµè§ˆå™¨å¹¶å¯ç”¨å®éªŒæ€§ AI åŠŸèƒ½ã€‚');
                    this.disableButtons();
                    return false;
                }

                try {
                    const availability = await Promise.race([
                        Summarizer.availability(),
                        new Promise((_, reject) =>
                            setTimeout(() => reject(new Error('API æ£€æŸ¥è¶…æ—¶')), 10000)
                        )
                    ]);

                    if (availability === 'unavailable') {
                        this.showError('æ‘˜è¦ API å½“å‰ä¸å¯ç”¨ã€‚è¯·ç¨åé‡è¯•æˆ–æ£€æŸ¥æµè§ˆå™¨è®¾ç½®ã€‚');
                        this.disableButtons();
                        return false;
                    }

                    if (availability === 'readily') {
                        this.showStatus('æ‘˜è¦ API å·²å°±ç»ªï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨');
                    } else {
                        this.showStatus('æ‘˜è¦ API å¯ç”¨ã€‚âš ï¸ é¦–æ¬¡ä½¿ç”¨éœ€è¦ä¸‹è½½æ¨¡å‹ï¼ˆçº¦30-100MBï¼‰ï¼Œè¯·è€å¿ƒç­‰å¾…');
                    }
                    return true;
                } catch (error) {
                    this.showError(`API æ£€æŸ¥å¤±è´¥: ${error.message}`);
                    this.disableButtons();
                    return false;
                }
            }

            async createSummarizer() {
                if (this.summarizer) {
                    return this.summarizer;
                }

                if (!navigator.userActivation.isActive) {
                    this.showError('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½åˆ›å»ºæ‘˜è¦å™¨ï¼Œè¯·ç‚¹å‡»æŒ‰é’®åé‡è¯•ã€‚');
                    return null;
                }

                // æ˜¾ç¤ºä¸‹è½½æç¤º
                this.downloadTip.style.display = 'block';

                try {
                    const options = {
                        type: this.summaryType.value,
                        format: this.summaryFormat.value,
                        length: this.summaryLength.value,
                        outputLanguage: this.outputLanguage.value,
                        monitor: (m) => {
                            this.showProgress(0, 'å¼€å§‹ä¸‹è½½æ¨¡å‹...');

                            m.addEventListener('downloadprogress', (e) => {
                                const progress = Math.round(e.loaded * 100);
                                const progressText = `æ­£åœ¨ä¸‹è½½æ¨¡å‹: ${progress}%`;
                                this.showProgress(e.loaded, progressText);
                            });
                        }
                    };

                    this.showStatus('æ­£åœ¨åˆ›å»ºæ‘˜è¦å™¨...');
                    this.showProgress(0, 'æ­£åœ¨åˆå§‹åŒ–æ‘˜è¦å™¨...');

                    // æ·»åŠ è¶…æ—¶å¤„ç†å’Œè¿›åº¦æ¨¡æ‹Ÿ
                    const createPromise = Summarizer.create(options);

                    // å¦‚æœæ²¡æœ‰ä¸‹è½½è¿›åº¦äº‹ä»¶ï¼Œæ˜¾ç¤ºä¸€ä¸ªæ¨¡æ‹Ÿçš„è¿›åº¦
                    let simulatedProgress = 0;
                    const progressInterval = setInterval(() => {
                        if (simulatedProgress < 0.95) {
                            simulatedProgress += Math.random() * 0.1;
                            if (simulatedProgress > 0.95) simulatedProgress = 0.95;
                            this.showProgress(simulatedProgress, 'æ­£åœ¨ä¸‹è½½å’ŒåŠ è½½æ¨¡å‹...');
                        }
                    }, 2000);

                    const timeoutPromise = new Promise((_, reject) =>
                        setTimeout(() => {
                            clearInterval(progressInterval);
                            reject(new Error('åˆ›å»ºæ‘˜è¦å™¨è¶…æ—¶ (120ç§’) - å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æ¨¡å‹ä¸‹è½½å¤±è´¥'));
                        }, 120000)
                    );

                    this.summarizer = await Promise.race([createPromise, timeoutPromise]);

                    clearInterval(progressInterval);
                    this.showProgress(1, 'æ‘˜è¦å™¨åˆ›å»ºå®Œæˆï¼');

                    // å»¶è¿Ÿä¸€ä¸‹è®©ç”¨æˆ·çœ‹åˆ°100%
                    setTimeout(() => {
                        this.hideProgress();
                        this.downloadTip.style.display = 'none';
                    }, 1000);

                    return this.summarizer;
                } catch (error) {
                    this.showError(`åˆ›å»ºæ‘˜è¦å™¨å¤±è´¥: ${error.message}`);
                    this.hideProgress();
                    this.downloadTip.style.display = 'none';
                    return null;
                }
            }

            async summarize() {
                const text = this.inputText.value.trim();
                if (!text) {
                    this.showError('è¯·è¾“å…¥è¦æ‘˜è¦çš„æ–‡æœ¬');
                    return;
                }

                if (this.isStreaming || this.currentOperation) {
                    this.showError('æ­£åœ¨è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¯·ç­‰å¾…å®Œæˆåå†è¯•');
                    return;
                }

                try {
                    this.currentOperation = 'summarize';
                    this.disableButtons();
                    this.showCancelButton();
                    this.showStatus('æ­£åœ¨ç”Ÿæˆæ‘˜è¦...');

                    const summarizer = await this.createSummarizer();
                    if (!summarizer) return;

                    const context = this.contextText.value.trim();
                    const options = context ? { context } : {};

                    // è®¾ç½®æ“ä½œè¶…æ—¶
                    const timeoutPromise = new Promise((_, reject) => {
                        this.operationTimeout = setTimeout(() =>
                            reject(new Error('æ‘˜è¦ç”Ÿæˆè¶…æ—¶ (120ç§’)')), 120000
                        );
                    });

                    const summaryPromise = summarizer.summarize(text, options);
                    const summary = await Promise.race([summaryPromise, timeoutPromise]);

                    this.displayResult(summary);
                    this.showStatus('æ‘˜è¦ç”Ÿæˆå®Œæˆ');
                } catch (error) {
                    if (error.message === 'æ“ä½œå·²å–æ¶ˆ') {
                        this.showStatus('æ“ä½œå·²å–æ¶ˆ');
                    } else {
                        this.showError(`æ‘˜è¦ç”Ÿæˆå¤±è´¥: ${error.message}`);
                    }
                } finally {
                    this.currentOperation = null;
                    this.clearOperationTimeout();
                    this.enableButtons();
                    this.hideCancelButton();
                }
            }

            async summarizeStreaming() {
                const text = this.inputText.value.trim();
                if (!text) {
                    this.showError('è¯·è¾“å…¥è¦æ‘˜è¦çš„æ–‡æœ¬');
                    return;
                }

                if (this.isStreaming || this.currentOperation) {
                    this.showError('æ­£åœ¨è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¯·ç­‰å¾…å®Œæˆåå†è¯•');
                    return;
                }

                try {
                    this.isStreaming = true;
                    this.currentOperation = 'stream';
                    this.disableButtons();
                    this.showCancelButton();
                    this.showStatus('æ­£åœ¨è¿›è¡Œæµå¼æ‘˜è¦...');
                    this.outputText.classList.add('streaming');
                    this.outputText.textContent = '';

                    const summarizer = await this.createSummarizer();
                    if (!summarizer) return;

                    const context = this.contextText.value.trim();
                    const options = context ? { context } : {};

                    // è®¾ç½®è¶…æ—¶
                    const timeoutId = setTimeout(() => {
                        throw new Error('æµå¼æ‘˜è¦è¶…æ—¶ (180ç§’)');
                    }, 180000);

                    const stream = summarizer.summarizeStreaming(text, options);

                    for await (const chunk of stream) {
                        if (this.currentOperation !== 'stream') {
                            // æ“ä½œè¢«å–æ¶ˆ
                            throw new Error('æ“ä½œå·²å–æ¶ˆ');
                        }
                        this.outputText.textContent += chunk;
                    }

                    clearTimeout(timeoutId);
                    this.outputText.classList.remove('streaming');
                    this.showStatus('æµå¼æ‘˜è¦å®Œæˆ');
                } catch (error) {
                    this.outputText.classList.remove('streaming');
                    if (error.message === 'æ“ä½œå·²å–æ¶ˆ') {
                        this.showStatus('æ“ä½œå·²å–æ¶ˆ');
                    } else {
                        this.showError(`æµå¼æ‘˜è¦å¤±è´¥: ${error.message}`);
                    }
                } finally {
                    this.isStreaming = false;
                    this.currentOperation = null;
                    this.clearOperationTimeout();
                    this.enableButtons();
                    this.hideCancelButton();
                }
            }

            displayResult(result) {
                this.outputText.textContent = result;
                this.outputText.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            resetSummarizer() {
                this.summarizer = null;
                this.showStatus('é€‰é¡¹å·²æ›´æ”¹ï¼Œä¸‹æ¬¡æ“ä½œå°†é‡æ–°åˆ›å»ºæ‘˜è¦å™¨');
            }

            disableButtons() {
                this.summarizeBtn.disabled = true;
                this.streamBtn.disabled = true;
            }

            enableButtons() {
                this.summarizeBtn.disabled = false;
                this.streamBtn.disabled = false;
            }

            showStatus(message) {
                this.status.textContent = message;
                this.status.style.display = 'block';
                this.hideError();
            }

            hideStatus() {
                this.status.textContent = '';
            }

            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.display = 'block';
                this.hideStatus();
                this.hideProgress();
            }

            hideError() {
                this.errorMessage.style.display = 'none';
            }

            showProgress(progress, statusText = '') {
                const percentage = Math.round(progress * 100);

                // æ˜¾ç¤ºè¿›åº¦æ¡å’Œä¿¡æ¯
                this.progressBar.style.display = 'block';
                this.progressInfo.classList.add('active');
                this.progressFill.style.width = `${percentage}%`;
                this.progressPercentage.textContent = `${percentage}%`;

                if (statusText) {
                    this.progressStatus.textContent = statusText;
                    this.showStatus(statusText);
                }

                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                if (percentage === 0) {
                    this.progressStatus.textContent = 'åˆå§‹åŒ–ä¸‹è½½...';
                } else if (percentage === 100) {
                    this.progressStatus.textContent = 'ä¸‹è½½å®Œæˆï¼Œæ­£åœ¨åŠ è½½æ¨¡å‹...';
                }
            }

            hideProgress() {
                this.progressBar.style.display = 'none';
                this.progressInfo.classList.remove('active');
                this.progressFill.style.width = '0%';
                this.progressPercentage.textContent = '0%';
                this.progressStatus.textContent = 'å‡†å¤‡ä¸‹è½½...';
            }

            loadSampleContent() {
                // é¢„è®¾çš„ç¤ºä¾‹æ–‡ç« å†…å®¹
                this.sampleArticles = {
                    'æŠ€æœ¯æ–‡ç« ': `ç°ä»£å‰ç«¯å¼€å‘å·²ç»ä»ç®€å•çš„HTMLã€CSSå’ŒJavaScriptæ¼”å˜æˆä¸€ä¸ªå¤æ‚çš„ç”Ÿæ€ç³»ç»Ÿã€‚Reactã€Vueå’ŒAngularç­‰æ¡†æ¶æ”¹å˜äº†æˆ‘ä»¬æ„å»ºç”¨æˆ·ç•Œé¢çš„æ–¹å¼ï¼Œå®ƒä»¬æä¾›äº†ç»„ä»¶åŒ–çš„å¼€å‘æ¨¡å¼ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚

åŒæ—¶ï¼Œæ„å»ºå·¥å…·å¦‚Webpackã€Viteå’ŒParcelç®€åŒ–äº†å¼€å‘æµç¨‹ï¼Œè‡ªåŠ¨åŒ–äº†ä»£ç æ‰“åŒ…ã€ä¼˜åŒ–å’Œéƒ¨ç½²è¿‡ç¨‹ã€‚TypeScriptçš„æ™®åŠæé«˜äº†ä»£ç çš„ç±»å‹å®‰å…¨æ€§ï¼Œå‡å°‘äº†è¿è¡Œæ—¶é”™è¯¯ã€‚

ç°ä»£å‰ç«¯å¼€å‘è¿˜éœ€è¦è€ƒè™‘æ€§èƒ½ä¼˜åŒ–ã€å¯è®¿é—®æ€§ã€SEOä¼˜åŒ–å’Œç§»åŠ¨ç«¯é€‚é…ç­‰å¤šä¸ªæ–¹é¢ã€‚PWAï¼ˆæ¸è¿›å¼Webåº”ç”¨ï¼‰æŠ€æœ¯è®©Webåº”ç”¨å…·å¤‡äº†ç±»ä¼¼åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚

å¾®å‰ç«¯æ¶æ„æ­£åœ¨æˆä¸ºå¤§å‹åº”ç”¨çš„æ–°é€‰æ‹©ï¼Œå®ƒå…è®¸ä¸åŒå›¢é˜Ÿç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²åº”ç”¨çš„ä¸åŒéƒ¨åˆ†ã€‚åŒæ—¶ï¼ŒServerlesså’ŒJAMstackç­‰æ–°å…´æ¶æ„æ¨¡å¼ä¹Ÿåœ¨æ”¹å˜æˆ‘ä»¬å¯¹Webåº”ç”¨éƒ¨ç½²å’Œè¿ç»´çš„è®¤çŸ¥ã€‚`,

                    'ç§‘å­¦ç ”ç©¶': `è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰æ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸçš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œä¸“æ³¨äºä½¿è®¡ç®—æœºèƒ½å¤Ÿç†è§£ã€è§£é‡Šå’Œç”Ÿæˆäººç±»è¯­è¨€ã€‚è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„å‘å±•æå¤§åœ°æ¨åŠ¨äº†NLPé¢†åŸŸçš„è¿›æ­¥ã€‚

Transformeræ¶æ„çš„å‡ºç°æ ‡å¿—ç€NLPå‘å±•çš„ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ã€‚åŸºäºTransformerçš„æ¨¡å‹å¦‚BERTã€GPTç³»åˆ—å’ŒT5ç­‰åœ¨å„ç§NLPä»»åŠ¡ä¸­éƒ½å–å¾—äº†çªç ´æ€§çš„æˆæœã€‚è¿™äº›å¤§å‹è¯­è¨€æ¨¡å‹é€šè¿‡åœ¨æµ·é‡æ–‡æœ¬æ•°æ®ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œå­¦ä¹ åˆ°äº†ä¸°å¯Œçš„è¯­è¨€çŸ¥è¯†å’Œæ¨¡å¼ã€‚

é¢„è®­ç»ƒ-å¾®è°ƒçš„èŒƒå¼æˆä¸ºäº†NLPä»»åŠ¡çš„æ ‡å‡†æ–¹æ³•ã€‚é¢„è®­ç»ƒæ¨¡å‹åœ¨å¤§è§„æ¨¡æ— æ ‡æ³¨æ•°æ®ä¸Šå­¦ä¹ é€šç”¨çš„è¯­è¨€è¡¨ç¤ºï¼Œç„¶ååœ¨ç‰¹å®šä»»åŠ¡çš„æ ‡æ³¨æ•°æ®ä¸Šè¿›è¡Œå¾®è°ƒï¼Œè¿™ç§æ–¹æ³•æ˜¾è‘—æé«˜äº†æ¨¡å‹åœ¨å„ç§ä¸‹æ¸¸ä»»åŠ¡ä¸Šçš„æ€§èƒ½ã€‚

å¤šæ¨¡æ€å­¦ä¹ ä¹Ÿæ˜¯å½“å‰ç ”ç©¶çš„çƒ­ç‚¹ï¼Œå°†æ–‡æœ¬ä¸å›¾åƒã€éŸ³é¢‘ç­‰å…¶ä»–æ¨¡æ€çš„ä¿¡æ¯ç»“åˆï¼Œå®ç°æ›´å…¨é¢çš„ç†è§£å’Œç”Ÿæˆã€‚åŒæ—¶ï¼Œæ¨¡å‹çš„å¯è§£é‡Šæ€§ã€å…¬å¹³æ€§å’Œå®‰å…¨æ€§ä¹Ÿè¶Šæ¥è¶Šå—åˆ°å…³æ³¨ã€‚`,

                    'æ–°é—»æ–‡ç« ': `äººå·¥æ™ºèƒ½æŠ€æœ¯æ­£åœ¨å¿«é€Ÿå‘å±•å¹¶æ·±åˆ»å½±å“å„ä¸ªè¡Œä¸šã€‚æœ€æ–°çš„å¤§å‹è¯­è¨€æ¨¡å‹å±•ç°å‡ºäº†å‰æ‰€æœªæœ‰çš„èƒ½åŠ›ï¼Œä¸ä»…èƒ½å¤Ÿè¿›è¡Œè‡ªç„¶å¯¹è¯ï¼Œè¿˜èƒ½ååŠ©ç¼–ç¨‹ã€å†™ä½œã€åˆ†æå’Œåˆ›ä½œç­‰å¤šç§ä»»åŠ¡ã€‚

ç§‘æŠ€å·¨å¤´ä»¬æ­£åœ¨åŠ å¤§å¯¹AIæŠ€æœ¯çš„æŠ•èµ„ã€‚è°·æ­Œã€å¾®è½¯ã€OpenAIç­‰å…¬å¸åœ¨AIæ¨¡å‹å’Œåº”ç”¨å¼€å‘æ–¹é¢å±•ç°å‡ºæ¿€çƒˆç«äº‰ã€‚åŒæ—¶ï¼ŒAIèŠ¯ç‰‡çš„å‘å±•ä¹Ÿåœ¨åŠ é€Ÿï¼Œä¸“é—¨ä¸ºAIè®¡ç®—ä¼˜åŒ–çš„å¤„ç†å™¨æ­£åœ¨æ¨åŠ¨æ•´ä¸ªè¡Œä¸šçš„å‘å±•ã€‚

è‡ªåŠ¨é©¾é©¶æŠ€æœ¯ä¹Ÿå–å¾—äº†é‡è¦è¿›å±•ï¼Œå¤šå®¶å…¬å¸çš„è‡ªåŠ¨é©¾é©¶æµ‹è¯•è½¦è¾†å·²ç»åœ¨å¤šä¸ªåŸå¸‚è¿›è¡Œè·¯æµ‹ã€‚è™½ç„¶å®Œå…¨è‡ªåŠ¨é©¾é©¶ä»é¢ä¸´æŠ€æœ¯å’Œæ³•å¾‹æŒ‘æˆ˜ï¼Œä½†Level 4çº§åˆ«çš„è‡ªåŠ¨é©¾é©¶åœ¨ç‰¹å®šåœºæ™¯ä¸‹å·²ç»å¼€å§‹å•†ä¸šåŒ–åº”ç”¨ã€‚

ä¸æ­¤åŒæ—¶ï¼ŒAIæŠ€æœ¯çš„å‘å±•ä¹Ÿå¼•å‘äº†å…³äºå°±ä¸šã€éšç§ã€å®‰å…¨å’Œä¼¦ç†ç­‰æ–¹é¢çš„è®¨è®ºã€‚å¦‚ä½•ç¡®ä¿AIæŠ€æœ¯çš„å‘å±•é€ ç¦äººç±»ï¼Œæˆä¸ºäº†å…¨ç¤¾ä¼šå…³æ³¨çš„é‡è¦è®®é¢˜ã€‚`,

                    'ç”¨æˆ·æ‰‹å†Œ': `æœ¬ç”¨æˆ·æ‰‹å†Œå°†æŒ‡å¯¼æ‚¨å¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„é¡¹ç›®ç®¡ç†è½¯ä»¶æ¥æé«˜å›¢é˜Ÿåä½œæ•ˆç‡ã€‚è¯¥è½¯ä»¶é›†æˆäº†ä»»åŠ¡ç®¡ç†ã€æ—¶é—´è¿½è¸ªã€å›¢é˜Ÿæ²Ÿé€šå’Œé¡¹ç›®æŠ¥å‘Šç­‰åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œåˆ›å»ºé¡¹ç›®æ˜¯ä½¿ç”¨è½¯ä»¶çš„ç¬¬ä¸€æ­¥ã€‚ç‚¹å‡»"æ–°å»ºé¡¹ç›®"æŒ‰é’®ï¼Œè¾“å…¥é¡¹ç›®åç§°ã€æè¿°å’Œé¢„è®¡å®Œæˆæ—¶é—´ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨é¢„è®¾çš„é¡¹ç›®æ¨¡æ¿ï¼Œå¦‚æ•æ·å¼€å‘ã€å¸‚åœºè¥é”€æˆ–äº§å“å‘å¸ƒç­‰æ¨¡æ¿ï¼Œè¿™äº›æ¨¡æ¿åŒ…å«äº†ç›¸åº”çš„ä»»åŠ¡ç»“æ„å’Œå·¥ä½œæµç¨‹ã€‚

ä»»åŠ¡ç®¡ç†æ˜¯æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥åˆ›å»ºä»»åŠ¡ã€åˆ†é…ç»™å›¢é˜Ÿæˆå‘˜ã€è®¾ç½®ä¼˜å…ˆçº§å’Œæˆªæ­¢æ—¥æœŸã€‚ä»»åŠ¡å¯ä»¥é€šè¿‡æ‹–æ‹½æ–¹å¼åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´ç§»åŠ¨ï¼Œå¦‚"å¾…åŠ"ã€"è¿›è¡Œä¸­"ã€"å®¡æ ¸ä¸­"å’Œ"å·²å®Œæˆ"ã€‚å­ä»»åŠ¡åŠŸèƒ½å…è®¸æ‚¨å°†å¤æ‚çš„ä»»åŠ¡åˆ†è§£ä¸ºæ›´å°çš„å¯ç®¡ç†å•å…ƒã€‚

æ—¶é—´è·Ÿè¸ªåŠŸèƒ½å¸®åŠ©æ‚¨äº†è§£é¡¹ç›®è¿›åº¦å’Œèµ„æºåˆ†é…ã€‚å›¢é˜Ÿæˆå‘˜å¯ä»¥è®°å½•åœ¨å„ä¸ªä»»åŠ¡ä¸ŠèŠ±è´¹çš„æ—¶é—´ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæ—¶é—´æŠ¥å‘Šå’Œé¡¹ç›®è¿›åº¦ç»Ÿè®¡ã€‚é›†æˆçš„æ—¥å†åŠŸèƒ½å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰é‡è¦çš„æˆªæ­¢æ—¥æœŸå’Œé‡Œç¨‹ç¢‘ã€‚`
                };
            }

            loadSampleArticle(title, context) {
                if (this.sampleArticles[title]) {
                    this.inputText.value = this.sampleArticles[title];
                    this.contextText.value = context || '';
                    this.showStatus(`å·²åŠ è½½ç¤ºä¾‹æ–‡ç« : ${title}`);
                    // æ¸…é™¤ä¹‹å‰çš„è¾“å‡º
                    this.outputText.textContent = 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ç”Ÿæˆæ‘˜è¦...';
                } else {
                    this.showError(`æœªæ‰¾åˆ°ç¤ºä¾‹æ–‡ç« : ${title}`);
                }
            }

            cancelOperation() {
                if (this.currentOperation) {
                    this.currentOperation = null;
                    this.isStreaming = false;
                    this.clearOperationTimeout();
                    this.showStatus('æ­£åœ¨å–æ¶ˆæ“ä½œ...');

                    // é‡ç½®UIçŠ¶æ€
                    this.outputText.classList.remove('streaming');
                    this.enableButtons();
                    this.hideCancelButton();
                    this.hideProgress();

                    setTimeout(() => {
                        this.showStatus('æ“ä½œå·²å–æ¶ˆ');
                    }, 500);
                } else {
                    this.showError('æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œ');
                }
            }

            clearOperationTimeout() {
                if (this.operationTimeout) {
                    clearTimeout(this.operationTimeout);
                    this.operationTimeout = null;
                }
            }

            showCancelButton() {
                this.cancelBtn.classList.add('active');
            }

            hideCancelButton() {
                this.cancelBtn.classList.remove('active');
            }
        }

        // åˆå§‹åŒ–æ¼”ç¤º
        new SummarizerDemo();
    </script>
</body>
</html>
